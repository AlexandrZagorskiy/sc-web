var scgViewerWindow=function(a){this._initWindow(a)};scgViewerWindow.prototype={_initWindow:function(a){this.domContainer=a.container;this.renderer=null},recieveData:function(b){var a=this._buildGraph(b);if(!a){console.warn("Build graph error");return}$("#"+this.domContainer).empty();this.renderer=new scgKineticRenderer({graph:a,container:this.domContainer,width:800,height:600});this.renderer.render();window.renderer=this.renderer},translateIdentifiers:function(){console.log("scgViewer translate event",this)},_buildGraph:function(b){var a=GraphBuilder.buildGraph(b);return a}};SCgComponent={type:0,outputLang:"format_scg_json",factory:function(a){return new scgViewerWindow(a)}};$(document).ready(function(){SCWeb.core.ComponentManager.appendComponentInitialize(function(){SCWeb.core.ComponentManager.registerComponent(SCgComponent)})});var scArc=function(c,a,b){this._initScArc(c,a,b)};scArc.prototype={_initScArc:function(c,a,b){this.id=b.id;this.type=parseInt(b.type);this.isArc=true;this._beginNode=c;this._beginNodePos=b.beginPos;this._endNode=a;this._endNodePos=b.endPos;this._incidentArcs=[];this._breaks=b.breaks||[];this.color=b.color;this._beginNode.addIncidentArc(this);this._endNode.addIncidentArc(this)},addIncidentArc:function(a){this._incidentArcs[a.id]=a;return this},setBeginNode:function(a){this._beginNode=a},setEndNode:function(a){this._endNode=a},getBeginNode:function(){return this._beginNode},getEndNode:function(){return this._endNode},addBreak:function(a){this._breaks.push(a)},getPosition:function(h){if(!h){h=0.5}h=Number(h);var g=h%1;var f=h-g;var b=this._getLines()[f];var d=b.begin;var e=b.end;var c=(d.x-e.x)*g;var a=(d.y-e.y)*g;return{x:d.x-c,y:d.y-a}},_getPoints:function(){var b=[];b.push(this._beginNode.getPosition(this._beginNodePos));var c=this._breaks;for(var a=0;a<c.length;a++){b.push(c[a])}b.push(this._endNode.getPosition(this._endNodePos));return b},_getLines:function(){var c=this._getPoints();var a=[];for(var b=0;b<c.length-1;b++){a.push({begin:c[b],end:c[b+1]})}return a},_getLastLine:function(){var a=this._getLines();return a[a.length-1]},_getFirstLine:function(){return this._getLines()[0]},_getType:function(a){var b=this.type.split("/");return b[a]},isAccessory:function(){return(this.type&sc_type_arc_access)==sc_type_arc_access},isOriented:function(){return true},isNegative:function(){return(this.type&sc_type_positivity_mask)==sc_type_arc_neg},isFuzzy:function(){return(this.type&sc_type_positivity_mask)==sc_type_arc_fuz},isPositive:function(){return(this.type&sc_type_positivity_mask)==sc_type_arc_pos},isVariable:function(){return(this.type&sc_type_constancy_mask)==sc_type_var},isTemporal:function(){return(this.type&sc_type_permanency_mask)==sc_type_arc_temp},isUndefined:function(b,a){return false}};var scGraph=function(){this._initScGraph()};scGraph.prototype={_initScGraph:function(){this.arcs={};this.nodes={}},addArc:function(a){this.arcs[a.id]=a;return this},addNode:function(a){this.nodes[a.id]=a;return this},getArcById:function(a){if(this.arcs[a]){return this.arcs[a]}return null},getNodeById:function(a){if(this.nodes[a]){return this.nodes[a]}return this.nodes[a]}};var sc_type_node=1;var sc_type_link=2;var sc_type_edge_common=4;var sc_type_arc_common=8;var sc_type_arc_access=16;var sc_type_const=32;var sc_type_var=64;var sc_type_arc_pos=128;var sc_type_arc_neg=256;var sc_type_arc_fuz=512;var sc_type_arc_temp=1024;var sc_type_arc_perm=2048;var sc_type_node_tuple=(128|sc_type_node);var sc_type_node_struct=(256|sc_type_node);var sc_type_node_role=(512|sc_type_node);var sc_type_node_norole=(1024|sc_type_node);var sc_type_node_class=(2048|sc_type_node);var sc_type_node_abstract=(4096|sc_type_node);var sc_type_node_material=(8192|sc_type_node);var sc_type_arc_pos_const_perm=(sc_type_arc_access|sc_type_const|sc_type_arc_pos|sc_type_arc_perm);var sc_type_element_mask=(sc_type_node|sc_type_link|sc_type_edge_common|sc_type_arc_common|sc_type_arc_access);var sc_type_constancy_mask=(sc_type_const|sc_type_var);var sc_type_positivity_mask=(sc_type_arc_pos|sc_type_arc_neg|sc_type_arc_fuz);var sc_type_permanency_mask=(sc_type_arc_perm|sc_type_arc_temp);var sc_type_node_struct_mask=(sc_type_node_tuple|sc_type_node_struct|sc_type_node_role|sc_type_node_norole|sc_type_node_class|sc_type_node_abstract|sc_type_node_material);var sc_type_arc_mask=(sc_type_arc_access|sc_type_arc_common|sc_type_edge_common);var GraphBuilder={elementType:{NODE:"node",LINK:"link",ARC:"arc"},nodeType:{LINK:sc_type_node|sc_type_const},LINK_SUFFIX:"_link",buildGraph:function(f){var e=new scGraph();var d=[];var a=0;var b={};for(idx in f){var g=f[idx];if(g.type==this.elementType.NODE){var c=this._buildNode(g);this._initNodePosition(c,a);e.addNode(c);a++;b[g.id]=c}if(g.type==this.elementType.ARC){d.push(g)}if(g.type==this.elementType.LINK){var c=this._buildLinkNode(g);this._initNodePosition(c,a);e.addNode(c);a++;b[g.id]=c}}this._buildArcs(d,b,e);return e},_buildNode:function(b){var a={id:b.id,idf:b.identifier,type:b.el_type};return new scNode(a)},_initNodePosition:function(c,b){var a=this._calcXNodePos(b);var d=this._calcYNodePos(b);c.setPosition(a,d)},_calcXNodePos:function(a){return 100+a*25},_calcYNodePos:function(a){return 70+a*30},_buildLinkNode:function(b){var a={id:b.id,idf:b.identifier+this.LINK_SUFFIX,type:this.nodeType.LINK};return new scNode(a)},_buildArcs:function(b,h,j){var g=true;while(b.length>0&&g){g=false;for(idx in b){var d=b[idx];var i=d.begin;var f=d.end;if(h.hasOwnProperty(i)&&h.hasOwnProperty(f)){var c=h[i];var e=h[f];var a=this._buildArc(d,c,e);g=true;b.splice(idx,1);h[d.id]=a;j.addArc(a)}}}},_buildArc:function(b,d,c){var a={id:b.id,type:b.el_type};return new scArc(d,c,a)}};var scNode=function(a){this._initScNode(a)};scNode.prototype={_initScNode:function(a){this.id=a.id;this.type=parseInt(a.type);this._incidentArcs=a._incidentArcs||{};this._position=a.position||{};this.color=a.color;this.idf=a.idf||"";this.TYPE_POS_VAR=1;this.TYPE_POS_TYPE=2;this.isActive=false},getPosition:function(){return this._position},setPosition:function(a,b){if(a.x&&a.y){this._position.x=a.x;this._position.y=a.y}else{this._position.x=a;this._position.y=b}return this},addIncidentArc:function(a){this._incidentArcs[a.id]=a;return this},removeIncidentArc:function(a){if(this._incidentArcs[a.id]){delete this._incidentArcs[a.id]}return this},getStructType:function(){var b={tuple:sc_type_node_tuple,struct:sc_type_node_struct,role:sc_type_node_role,norole:sc_type_node_norole,"class":sc_type_node_class,"abstract":sc_type_node_abstract,material:sc_type_node_material};for(var a in b){if((this.type&sc_type_node_struct_mask)==b[a]){return a}}return"general"},isVariable:function(){return(this.type&sc_type_constancy_mask)==sc_type_var}};var scgArc=function(b,a,c){this._initArc(b,a,c)};scgArc.prototype={_initArc:function(b,a,c){this._arc=a;this._layer=b;this._drawObject=null;this._renderer=c;this.draw()},getRenderer:function(){return this._renderer},draw:function(){this._draw();if(this._arc.isOriented()){var a=this._prepareArrowPosition();var b=this._getArrow(a.begin,a.end);this._layer.add(b)}this._drawBreaks()},reDraw:function(){this._reDraw();if(this._arc.isOriented()){var a=this._prepareArrowPosition();this._getArrow(a.begin,a.end)}this._drawBreaks()},_draw:function(){var b=new Kinetic.Line(this.__defaultLineConfig);var a=this;b.setDrawFunc(function(d){a._lineDrawFunc.call(this,d,a)});var c=this._prepareLinePoints();b.setPoints(c);this._layer.add(b);this._drawObject=b},_reDraw:function(){this._drawObject.setPoints(this._prepareLinePoints())},_lineDrawFunc:function(b,a){for(var e=1;e<this.attrs.points.length;e++){var d=this.attrs.points[e];var c=this.attrs.points[e-1];b.beginPath();a._lineDrawPart(b,c,d,a);this.stroke(b)}if(!!this.attrs.lineCap){b.lineCap=this.attrs.lineCap}},_lineDrawPart:function(c,e,d,a){var b=a._arc;if(b.isTemporal()&&b.isVariable()){scgDrawFunction.dashVarLine(c,e,d)}if(b.isTemporal()&&!b.isVariable()){scgDrawFunction.dashLine(c,e,d)}if(b.isVariable()&&!b.isTemporal()&&!b.isUndefined(2,3)){scgDrawFunction.varLine(c,e,d)}if(b.isNegative()){scgDrawFunction.negLine(c,e,d)}if(b.isFuzzy()){scgDrawFunction.fuzLine(c,e,d)}if(b.isUndefined(1,4)&&b.isAccessory()){scgDrawFunction.simpleAccessoryLine(c,e,d)}if(b.isUndefined(1,4)&&!b.isAccessory()){scgDrawFunction.undefinedPairLine(c,e,d);return}if(b.isUndefined(2,4)&&!b.isAccessory()&&!b.isVariable()){scgDrawFunction.undefinedConstPairLine(c,e,d);return}if(b.isUndefined(2,4)&&!b.isAccessory()&&b.isVariable()){scgDrawFunction.undefinedVarPairLine(c,e,d);return}if(!b.isVariable()&&!b.isTemporal()){scgDrawFunction.simpleLine(c,e,d)}},_prepareArrowPosition:function(){var l=this._arc._getLastLine();var c=l.begin;var a=l.end;var k=a.x-c.x;var j=a.y-c.y;var g=Math.atan(j/k);if(k==0){g+=Math.PI}var i=k>0?1:-1;var h=j>0?1:-1;var d=Math.cos(g)*i;var b=Math.sin(g)*i;var f=scgConfig.Arc.nodeIndent+8;var e={x:a.x-d*f,y:a.y-b*f};return{begin:e,end:c}},_prepareLinePoints:function(){var c=this._arc._getPoints();var b=this._arc._getFirstLine();var a=this._arc._getLastLine();var e=this._prepareLinePositions(b.begin,b.end).end;var d=this._prepareLinePositions(a.begin,a.end).begin;c[0]=e;c[c.length-1]=d;return c},_prepareLinePositions:function(d,a){var m=a.x-d.x;var l=a.y-d.y;var i=Math.atan(l/m);if(m==0){i+=Math.PI}var k=m>0?1:-1;var j=l>0?1:-1;var e=Math.cos(i)*k;var c=Math.sin(i)*k;var h,g;h=scgConfig.Arc.nodeIndent;g=scgConfig.Arc.nodeIndent;if(this._arc.isOriented()){h+=10}var f={x:a.x-e*h,y:a.y-c*h};var b={x:d.x+e*g,y:d.y+c*g};return{begin:f,end:b}},_drawBreaks:function(){var b=this._arc._breaks;this._breaks=this._breaks||{};for(var a=0;a<b.length;a++){if(this._breaks[a]){this._breaks[a].setPosition(b[a])}else{var c=this._getBreak(b[a]);this._layer.add(c);this._breaks[a]=c}}},_getBreak:function(d){var c=this._defaultBreakConfig;c.x=d.x;c.y=d.y;var a=new Kinetic.Circle(c);var b=this;a.on("dragmove",function(){var e=this.getPosition();d.x=e.x;d.y=e.y;b.getRenderer().reDraw()});a.on("mouseover",function(){this.setFill("orange");b._layer.draw()});a.on("mouseout",function(){this.setFill(c.fill);b._layer.draw()});return a},_getArrow:function(c,d){if(!this._arrow){this._arrow=new Kinetic.Polygon(this.__defaultArrowConfig)}this._arrow.setPosition(c);var b=c.x-d.x;var a=c.y-d.y;var e=Math.atan2(a,b)-Math.PI/2;if(e){this._arrow.setAttrs({rotation:e})}return this._arrow},__defaultArrowConfig:{strokeWidth:1,stroke:"black",fill:"black",lineCap:"butt",points:[-3,-2,3,-2,0,6],rotate:0},_defaultBreakConfig:{x:100,y:100,radius:5,stroke:"#666",fill:"#ddd",strokeWidth:1,draggable:true},__defaultLineConfig:{strokeWidth:2,stroke:"black",lineCap:"butt",points:[0,0,1,1],lineJoin:"round"}};var scgDrawFunction={simpleLine:function(a,c,b){a.lineWidth=2;a.moveTo(c.x,c.y);a.lineTo(b.x,b.y)},dashLine:function(d,h,g){var f=Math.atan2(h.y-g.y,h.x-g.x)+Math.PI;d.translate(h.x,h.y);d.rotate(f);d.lineWidth=2;var e=scgConfig.Arc.DASH_VERT_OFFSET;var a=scgHelper.getHypotenuse(h,g);var b=Math.floor(a/scgConfig.Arc.DASH_HOR_OFFSET);for(var c=0;c<b;c++){if(c%2){d.lineTo(c*scgConfig.Arc.DASH_HOR_OFFSET,0)}else{d.moveTo(c*scgConfig.Arc.DASH_HOR_OFFSET,0)}}d.rotate(-f);d.translate(-h.x,-h.y)},dashVarLine:function(d,h,g){var f=Math.atan2(h.y-g.y,h.x-g.x)+Math.PI;d.translate(h.x,h.y);d.rotate(f);d.lineWidth=2;var a=scgHelper.getHypotenuse(h,g);var e=-3;for(var c=1;e<a;c++){if(c%2){d.moveTo(e+=8,0)}else{for(var b=0;b<4;b++){d.lineTo(e+=2,0);d.moveTo(e+=2,0)}}}d.rotate(-f);d.translate(-h.x,-h.y)},negLine:function(c,j,k){var e=Math.atan2(j.y-k.y,j.x-k.x)+Math.PI;c.translate(j.x,j.y);c.rotate(e);c.lineWidth=b;var g=scgConfig.Arc.DASH_VERT_OFFSET;var b=scgConfig.Arc.DASH_VERT_WIDTH;var a=scgHelper.getHypotenuse(j,k);var f=Math.floor(a/g);for(var h=1;h<=f;h++){var d=h%2;c.moveTo(h*g,b/2);c.lineTo(h*g,-b/2)}c.rotate(-e);c.translate(-j.x,-j.y)},fuzLine:function(c,j,k){var e=Math.atan2(j.y-k.y,j.x-k.x)+Math.PI;c.translate(j.x,j.y);c.rotate(e);c.lineWidth=b;var g=scgConfig.Arc.DASH_VERT_OFFSET;var b=scgConfig.Arc.DASH_VERT_WIDTH;var a=scgHelper.getHypotenuse(j,k);var f=Math.floor(a/g);for(var h=1;h<=f;h++){var d=h%2;c.moveTo(h*g,d*b/2);c.lineTo(h*g,(d-1)*b/2)}c.rotate(-e);c.translate(-j.x,-j.y)},varLine:function(d,h,j){var e=Math.atan2(h.y-j.y,h.x-j.x)+Math.PI;d.translate(h.x,h.y);d.rotate(e);var f=scgConfig.Arc.DASH_VERT_OFFSET;var c=scgConfig.Arc.DASH_VERT_WIDTH;var a=scgHelper.getHypotenuse(h,j);var b=-5;for(var g=1;b<a;g++){if(g%2){d.moveTo(b+=10,0)}else{var k=Math.min(a-b,14);d.lineTo(b+=k,0)}}d.rotate(-e);d.translate(-h.x,-h.y)},simpleAccessoryLine:function(d,h,g){d.stroke();d.beginPath();var f=Math.atan2(h.y-g.y,h.x-g.x)+Math.PI;d.translate(h.x,h.y);d.rotate(f);d.lineWidth=4;var a=scgHelper.getHypotenuse(h,g);var e=-5;for(var c=1;e<a;c++){if(c%2){d.moveTo(e+=10,0)}else{var b=Math.min(a-e,4);d.lineTo(e+=b,0)}}d.rotate(-f);d.translate(-h.x,-h.y);d.stroke()},undefinedPairLine:function(d,h,g){d.lineWidth=6;d.moveTo(h.x,h.y);d.lineTo(g.x,g.y);d.stroke();d.strokeStyle="#ffffff";d.beginPath();d.lineWidth=4;d.moveTo(h.x,h.y);d.lineTo(g.x,g.y);d.stroke();d.strokeStyle="#000";d.beginPath();var f=Math.atan2(h.y-g.y,h.x-g.x)+Math.PI;d.translate(h.x,h.y);d.rotate(f);d.strokeWidth=1;d.lineWidth=1;var a=scgHelper.getHypotenuse(h,g);var e=-5;for(var c=1;e<a;c++){if(c%2){d.moveTo(e+=10,0)}else{var b=Math.min(a-e,14);d.lineTo(e+=b,0)}}d.rotate(-f);d.translate(-h.x,-h.y)},undefinedConstPairLine:function(a,c,b){a.lineWidth=6;a.moveTo(c.x,c.y);a.lineTo(b.x,b.y);a.stroke();a.strokeStyle="#ffffff";a.beginPath();a.lineWidth=4;a.moveTo(c.x,c.y);a.lineTo(b.x,b.y);a.stroke();a.strokeStyle="#000";a.beginPath()},undefinedVarPairLine:function(d,h,g){d.lineWidth=6;d.moveTo(h.x,h.y);d.lineTo(g.x,g.y);d.stroke();d.strokeStyle="#ffffff";d.beginPath();d.lineWidth=4;var f=Math.atan2(h.y-g.y,h.x-g.x)+Math.PI;d.translate(h.x,h.y);d.rotate(f);var a=scgHelper.getHypotenuse(h,g);var e=-5;for(var c=1;e<a;c++){if(c%2){d.moveTo(e+=10,0)}else{var b=Math.min(a-e,14);d.lineTo(e+=b,0)}}d.rotate(-f);d.translate(-h.x,-h.y);d.stroke();d.beginPath();d.strokeStyle="#000"}};var scgConfig={};scgConfig.Arc={nodeIndent:20,DASH_VERT_OFFSET:24,DASH_VERT_WIDTH:10,DASH_HOR_OFFSET:2};scgConfig.Node={};var scgHelper={getHypotenuse:function(f,e){var d=Math.abs(f.x-e.x);var i=Math.abs(f.y-e.y);var c=Math.max(d,i);var g=Math.min(d,i);var h=g/c;return c*Math.sqrt(1+h*h)}};var scgKineticRenderer=function(a){this._initScgKineticRenderer(a)};scgKineticRenderer._renderers=[];scgKineticRenderer.registerTypeRenderer=function(a,b){scgKineticRenderer._renderers[a]=b;return scgKineticRenderer};scgKineticRenderer.getTypeRenderer=function(a){var b=(a&sc_type_element_mask);if(b==sc_type_arc_common||b==sc_type_arc_access||b==sc_type_edge_common){return scgArc}if(b==sc_type_node){if((a&sc_type_constancy_mask)==sc_type_const){return scgNodeConst}if((a&sc_type_constancy_mask)==sc_type_var){return scgNodeVar}}throw new Error("Undefined type of renderer "+a)};scgKineticRenderer.prototype={_initScgKineticRenderer:function(b){this._graph=b.graph;this._container=b.container;this._arcs=[];this._nodes=[];this._initProperties(b);var a=this._getStage();this._layerNodes=new Kinetic.Layer();this._layerArcs=this._layerNodes;a.add(this._layerArcs);a.add(this._layerNodes)},_initProperties:function(a){for(var b in a){if(!(b in this)){this["_"+b]=a[b]}}},_getStage:function(){if(!this._stage){this._stage=new Kinetic.Stage({container:this._container,width:this._width,height:this._height})}return this._stage},setGraph:function(a){this._graph=a},getGraph:function(){return this._graph},reDraw:function(){for(var a in this._arcs){this._arcs[a].reDraw()}for(var a in this._nodes){this._nodes[a].reDraw()}},render:function(){this._renderNodes();this._renderArcs();this._layerNodes.draw();this._layerArcs.draw()},_renderArcs:function(){var b=this._graph.arcs;for(var d in b){var c=scgKineticRenderer.getTypeRenderer(b[d].type);var a=new c(this._layerArcs,b[d],this);this._arcs.push(a)}},_renderNodes:function(){var a=this._graph.nodes;for(var d in a){var c=scgKineticRenderer.getTypeRenderer(a[d].type);var b=new c(this._layerNodes,a[d],this);this._nodes.push(b)}}};var scgNode=function(a,b,c){this._initNode(a,b,c)};scgNode.prototype={_initNode:function(a,b,c){this.id=0;this.layer=a;this.node=b;this.idfDrawObj=null;this.color="#000";this._renderer=c;this.draw();this.reDraw()},getRenderer:function(){return this._renderer},setColor:function(a){this.color=a},draw:function(){this.layer.add(this._getIdf());this._draw();return this},reDraw:function(){var a=this.node.getPosition();this._getIdf().setPosition(a.x+10,a.y+10);this._reDraw();return this},_getIdf:function(){if(this.idfDrawObj!=null){return this.idfDrawObj}this._defaultIdfConfig.text=this.node.idf;this.idfDrawObj=new Kinetic.Text(this._defaultIdfConfig);return this.idfDrawObj},_defaultIdfConfig:{x:110,y:110,text:"",textFill:"gray"}};var scgNodeConst=function(a,b,c){this._initNodeConst(a,b,c)};scgNodeConst.prototype={_initNodeConst:function(a,b,c){this._circle=null;this._bg=null;this._initNode(a,b,c)},_draw:function(){this.layer.add(this._getBg());this.layer.add(this._getCircle());return this},_reDraw:function(){var a=this.node.getPosition();this._getBg().setPosition(a);this._getCircle().setPosition(a);return this},_getCircle:function(){if(this._circle==null){this._circle=new Kinetic.Circle(this._defaultCircleConfig);this._circle.setPosition(this.node.getPosition());var a=this;this._circle.on("dragmove",function(){a.node.setPosition(this.getPosition());a.getRenderer().reDraw()});this._circle.on("mouseover",function(){a.setColor("#f0f");a.getRenderer().reDraw()});this._circle.on("mouseout",function(){a.setColor("#000");a.getRenderer().reDraw()})}this._circle.setStroke(this.color);return this._circle},_getBg:function(){if(this._bg==null){this._bg=new Kinetic.Shape();var a=this;this._bg.setDrawFunc(function(b){a._bgDrawFunc.call(this,b,a)})}return this._bg},_bgDrawFunc:function(c,a){var b=scgNodeConst.drawFunc[a.node.getStructType()];c.strokeStyle=a.color;c.fillStyle=a.color;b.call(this,c)},_defaultCircleConfig:{x:100,y:100,radius:9,stroke:"#000",strokeWidth:4,draggable:true}};Kinetic.Global.extend(scgNodeConst,scgNode);scgNodeConst.drawFunc={general:function(a){},relation:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,-7);a.lineTo(7,7);a.moveTo(7,-7);a.lineTo(-7,7);a.stroke()},role:function(a){a.beginPath();a.lineWidth=2;a.moveTo(0,-7);a.lineTo(0,7);a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},group:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,-7);a.lineTo(7,7);a.moveTo(7,-7);a.lineTo(-7,7);a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},tuple:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},"abstract":function(b){b.beginPath();b.lineWidth=1;for(var a=-6;a<7;a+=3){b.moveTo(-7,a);b.lineTo(7,a)}b.stroke()},struct:function(a){a.beginPath();a.arc(0,0,2,0,2*Math.PI,false);a.fill()},material:function(b){b.beginPath();b.rotate(-Math.PI/4);for(var a=-6;a<7;a+=3){b.moveTo(-7,a);b.lineTo(7,a)}b.rotate(Math.PI/4);b.stroke()}};var scgNodeVar=function(a,b,c){this._initNodeVar(a,b,c)};scgNodeVar.prototype={_initNodeVar:function(a,b,c){this._rect=null;this._bg=null;this._initNode(a,b,c)},_draw:function(){this.layer.add(this._getBg());this.layer.add(this._getRect());return this},_reDraw:function(){var a=this.node.getPosition();this._getBg().setPosition(a);this._getRect().setPosition(a);return this},_getRect:function(){if(this._rect==null){this._rect=new Kinetic.Rect(this._defaultRectConfig);this._rect.setPosition(this.node.getPosition().x,this.node.getPosition());var a=this;this._rect.on("dragmove",function(){a.node.setPosition(this.getPosition());a.getRenderer().reDraw()});this._rect.on("mouseover",function(){a.node.isActive=true});this._rect.on("mouseout",function(){a.node.isActive=false})}this._rect.setStroke(this.color);return this._rect},_getBg:function(){if(this._bg==null){this._bg=new Kinetic.Shape();var a=this;this._bg.setDrawFunc(function(b){a._bgDrawFunc.call(this,b,a)})}return this._bg},_bgDrawFunc:function(c,a){var b=scgNodeVar.drawFunc[a.node.getStructType()];c.strokeStyle=a.color;c.fillStyle=a.color;b.call(this,c)},_defaultRectConfig:{x:100,y:100,width:14,height:14,offset:{x:7,y:7},stroke:"#000",strokeWidth:4,draggable:true}};scgNodeVar.drawFunc={general:function(a){},relation:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,-7);a.lineTo(7,7);a.moveTo(7,-7);a.lineTo(-7,7);a.stroke()},role:function(a){a.beginPath();a.lineWidth=2;a.moveTo(0,-7);a.lineTo(0,7);a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},group:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,-7);a.lineTo(7,7);a.moveTo(7,-7);a.lineTo(-7,7);a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},tuple:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},"abstract":function(b){b.beginPath();b.lineWidth=1;for(var a=-6;a<7;a+=3){b.moveTo(-7,a);b.lineTo(7,a)}b.stroke()},struct:function(a){a.beginPath();a.arc(0,0,2,0,2*Math.PI,false);a.fill()},material:function(b){b.beginPath();b.rotate(-Math.PI/4);for(var a=-6;a<7;a+=3){b.moveTo(-6,a);b.lineTo(6,a)}b.rotate(Math.PI/4);b.stroke()}};Kinetic.Global.extend(scgNodeVar,scgNode);