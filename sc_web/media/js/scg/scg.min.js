var scgViewerWindow=function(a){this._initWindow(a)};
scgViewerWindow.prototype={_initWindow:function(a){this.domContainer=a.container;this.renderer=null},recieveData:function(a){(a=this._buildGraph(a))?($("#"+this.domContainer).empty(),this.renderer=new scgKineticRenderer({graph:a,container:this.domContainer,width:800,height:600}),this.renderer.render(),window.renderer=this.renderer):console.warn("Build graph error")},translateIdentifiers:function(){console.log("scgViewer translate event",this)},_buildGraph:function(a){return GraphBuilder.buildGraph(a)}};
SCgComponent={type:0,outputLang:"format_scg_json",factory:function(a){return new scgViewerWindow(a)}};$(document).ready(function(){SCWeb.core.ComponentManager.appendComponentInitialize(function(){SCWeb.core.ComponentManager.registerComponent(SCgComponent)})});var scArc=function(a,b,c){this._initScArc(a,b,c)};
scArc.prototype={_initScArc:function(a,b,c){this.id=c.id;this.type=parseInt(c.type);this.isArc=!0;this._beginNode=a;this._beginNodePos=c.beginPos;this._endNode=b;this._endNodePos=c.endPos;this._incidentArcs=[];this._breaks=c.breaks||[];this.color=c.color;this._beginNode.addIncidentArc(this);this._endNode.addIncidentArc(this)},addIncidentArc:function(a){this._incidentArcs[a.id]=a;return this},setBeginNode:function(a){this._beginNode=a},setEndNode:function(a){this._endNode=a},getBeginNode:function(){return this._beginNode},
getEndNode:function(){return this._endNode},addBreak:function(a){this._breaks.push(a)},getPosition:function(a){a||(a=0.5);a=Number(a);var b=a%1,c=this._getLines()[a-b];a=c.begin;c=c.end;return{x:a.x-(a.x-c.x)*b,y:a.y-(a.y-c.y)*b}},_getPoints:function(){var a=[];a.push(this._beginNode.getPosition(this._beginNodePos));for(var b=this._breaks,c=0;c<b.length;c++)a.push(b[c]);a.push(this._endNode.getPosition(this._endNodePos));return a},_getLines:function(){for(var a=this._getPoints(),b=[],c=0;c<a.length-
1;c++)b.push({begin:a[c],end:a[c+1]});return b},_getLastLine:function(){var a=this._getLines();return a[a.length-1]},_getFirstLine:function(){return this._getLines()[0]},_getType:function(a){return this.type.split("/")[a]},isAccessory:function(){return(this.type&sc_type_arc_access)==sc_type_arc_access},isOriented:function(){return!0},isNegative:function(){return(this.type&sc_type_positivity_mask)==sc_type_arc_neg},isFuzzy:function(){return(this.type&sc_type_positivity_mask)==sc_type_arc_fuz},isPositive:function(){return(this.type&
sc_type_positivity_mask)==sc_type_arc_pos},isVariable:function(){return(this.type&sc_type_constancy_mask)==sc_type_var},isTemporal:function(){return(this.type&sc_type_permanency_mask)==sc_type_arc_temp},isUndefined:function(){return!1}};var scGraph=function(){this._initScGraph()};
scGraph.prototype={_initScGraph:function(){this.arcs={};this.nodes={}},addArc:function(a){this.arcs[a.id]=a;return this},addNode:function(a){this.nodes[a.id]=a;return this},getArcById:function(a){return this.arcs[a]?this.arcs[a]:null},getNodeById:function(a){return this.nodes[a]}};
var sc_type_node=1,sc_type_link=2,sc_type_edge_common=4,sc_type_arc_common=8,sc_type_arc_access=16,sc_type_const=32,sc_type_var=64,sc_type_arc_pos=128,sc_type_arc_neg=256,sc_type_arc_fuz=512,sc_type_arc_temp=1024,sc_type_arc_perm=2048,sc_type_node_tuple=128|sc_type_node,sc_type_node_struct=256|sc_type_node,sc_type_node_role=512|sc_type_node,sc_type_node_norole=1024|sc_type_node,sc_type_node_class=2048|sc_type_node,sc_type_node_abstract=4096|sc_type_node,sc_type_node_material=8192|sc_type_node,sc_type_arc_pos_const_perm=
sc_type_arc_access|sc_type_const|sc_type_arc_pos|sc_type_arc_perm,sc_type_element_mask=sc_type_node|sc_type_link|sc_type_edge_common|sc_type_arc_common|sc_type_arc_access,sc_type_constancy_mask=sc_type_const|sc_type_var,sc_type_positivity_mask=sc_type_arc_pos|sc_type_arc_neg|sc_type_arc_fuz,sc_type_permanency_mask=sc_type_arc_perm|sc_type_arc_temp,sc_type_node_struct_mask=sc_type_node_tuple|sc_type_node_struct|sc_type_node_role|sc_type_node_norole|sc_type_node_class|sc_type_node_abstract|sc_type_node_material,
sc_type_arc_mask=sc_type_arc_access|sc_type_arc_common|sc_type_edge_common,GraphBuilder={elementType:{NODE:"node",LINK:"link",ARC:"arc"},nodeType:{LINK:sc_type_node|sc_type_const},LINK_SUFFIX:"_link",buildGraph:function(a){var b=new scGraph,c=[],e=0,d={};for(idx in a){var f=a[idx];if(f.type==this.elementType.NODE){var g=this._buildNode(f);this._initNodePosition(g,e);b.addNode(g);e++;d[f.id]=g}f.type==this.elementType.ARC&&c.push(f);f.type==this.elementType.LINK&&(g=this._buildLinkNode(f),this._initNodePosition(g,
e),b.addNode(g),e++,d[f.id]=g)}this._buildArcs(c,d,b);return b},_buildNode:function(a){return new scNode({id:a.id,idf:a.identifier,type:a.el_type})},_initNodePosition:function(a,b){var c=this._calcXNodePos(b),e=this._calcYNodePos(b);a.setPosition(c,e)},_calcXNodePos:function(a){return 100+25*a},_calcYNodePos:function(a){return 70+30*a},_buildLinkNode:function(a){return new scNode({id:a.id,idf:a.identifier+this.LINK_SUFFIX,type:this.nodeType.LINK})},_buildArcs:function(a,b,c){for(var e=!0;0<a.length&&
e;)for(idx in e=!1,a){var d=a[idx],f=d.begin,g=d.end;b.hasOwnProperty(f)&&b.hasOwnProperty(g)&&(f=this._buildArc(d,b[f],b[g]),e=!0,a.splice(idx,1),b[d.id]=f,c.addArc(f))}},_buildArc:function(a,b,c){return new scArc(b,c,{id:a.id,type:a.el_type})}},scNode=function(a){this._initScNode(a)};
scNode.prototype={_initScNode:function(a){this.id=a.id;this.type=parseInt(a.type);this._incidentArcs=a._incidentArcs||{};this._position=a.position||{};this.color=a.color;this.idf=a.idf||"";this.TYPE_POS_VAR=1;this.TYPE_POS_TYPE=2;this.isActive=!1},getPosition:function(){return this._position},setPosition:function(a,b){a.x&&a.y?(this._position.x=a.x,this._position.y=a.y):(this._position.x=a,this._position.y=b);return this},addIncidentArc:function(a){this._incidentArcs[a.id]=a;return this},removeIncidentArc:function(a){this._incidentArcs[a.id]&&
delete this._incidentArcs[a.id];return this},getStructType:function(){var a={tuple:sc_type_node_tuple,struct:sc_type_node_struct,role:sc_type_node_role,norole:sc_type_node_norole,"class":sc_type_node_class,"abstract":sc_type_node_abstract,material:sc_type_node_material},b;for(b in a)if((this.type&sc_type_node_struct_mask)==a[b])return b;return"general"},isVariable:function(){return(this.type&sc_type_constancy_mask)==sc_type_var}};var scgArc=function(a,b,c){this._initArc(a,b,c)};
scgArc.prototype={_initArc:function(a,b,c){this._arc=b;this._layer=a;this._drawObject=null;this._renderer=c;this.draw()},getRenderer:function(){return this._renderer},draw:function(){this._draw();if(this._arc.isOriented()){var a=this._prepareArrowPosition(),a=this._getArrow(a.begin,a.end);this._layer.add(a)}this._drawBreaks()},reDraw:function(){this._reDraw();if(this._arc.isOriented()){var a=this._prepareArrowPosition();this._getArrow(a.begin,a.end)}this._drawBreaks()},_draw:function(){var a=new Kinetic.Line(this.__defaultLineConfig),
b=this;a.setDrawFunc(function(a){b._lineDrawFunc.call(this,a,b)});var c=this._prepareLinePoints();a.setPoints(c);this._layer.add(a);this._drawObject=a},_reDraw:function(){this._drawObject.setPoints(this._prepareLinePoints())},_lineDrawFunc:function(a,b){for(var c=1;c<this.attrs.points.length;c++){var e=this.attrs.points[c],d=this.attrs.points[c-1];a.beginPath();b._lineDrawPart(a,d,e,b);this.stroke(a)}this.attrs.lineCap&&(a.lineCap=this.attrs.lineCap)},_lineDrawPart:function(a,b,c,e){e=e._arc;e.isTemporal()&&
e.isVariable()&&scgDrawFunction.dashVarLine(a,b,c);e.isTemporal()&&!e.isVariable()&&scgDrawFunction.dashLine(a,b,c);e.isVariable()&&(!e.isTemporal()&&!e.isUndefined(2,3))&&scgDrawFunction.varLine(a,b,c);e.isNegative()&&scgDrawFunction.negLine(a,b,c);e.isFuzzy()&&scgDrawFunction.fuzLine(a,b,c);switch(e.type){case sc_type_edge_common|sc_type_const:case sc_type_arc_common|sc_type_const:scgDrawFunction.undefinedConstPairLine(a,b,c);return;case sc_type_edge_common|sc_type_var:case sc_type_arc_common|sc_type_var:scgDrawFunction.undefinedVarPairLine(a,
b,c);return;case sc_type_edge_common:case sc_type_arc_common:scgDrawFunction.undefinedPairLine(a,b,c);return;case sc_type_arc_access:scgDrawFunction.simpleAccessoryLine(a,b,c);return}!e.isVariable()&&!e.isTemporal()&&scgDrawFunction.simpleLine(a,b,c)},_prepareArrowPosition:function(){var a=this._arc._getLastLine(),b=a.begin,a=a.end,c=a.x-b.x,e=Math.atan((a.y-b.y)/c);0==c&&(e+=Math.PI);var d=0<c?1:-1,c=Math.cos(e)*d,e=Math.sin(e)*d,d=scgConfig.Arc.nodeIndent+8;return{begin:{x:a.x-c*d,y:a.y-e*d},end:b}},
_prepareLinePoints:function(){var a=this._arc._getPoints(),b=this._arc._getFirstLine(),c=this._arc._getLastLine(),b=this._prepareLinePositions(b.begin,b.end).end,c=this._prepareLinePositions(c.begin,c.end).begin;a[0]=b;a[a.length-1]=c;return a},_prepareLinePositions:function(a,b){var c=b.x-a.x,e=Math.atan((b.y-a.y)/c);0==c&&(e+=Math.PI);var d=0<c?1:-1,c=Math.cos(e)*d,e=Math.sin(e)*d,f;f=d=scgConfig.Arc.nodeIndent;this._arc.isOriented()&&(d+=10);return{begin:{x:b.x-c*d,y:b.y-e*d},end:{x:a.x+c*f,y:a.y+
e*f}}},_drawBreaks:function(){var a=this._arc._breaks;this._breaks=this._breaks||{};for(var b=0;b<a.length;b++)if(this._breaks[b])this._breaks[b].setPosition(a[b]);else{var c=this._getBreak(a[b]);this._layer.add(c);this._breaks[b]=c}},_getBreak:function(a){var b=this._defaultBreakConfig;b.x=a.x;b.y=a.y;var c=new Kinetic.Circle(b),e=this;c.on("dragmove",function(){var b=this.getPosition();a.x=b.x;a.y=b.y;e.getRenderer().reDraw()});c.on("mouseover",function(){this.setFill("orange");e._layer.draw()});
c.on("mouseout",function(){this.setFill(b.fill);e._layer.draw()});return c},_getArrow:function(a,b){this._arrow||(this._arrow=new Kinetic.Polygon(this.__defaultArrowConfig));this._arrow.setPosition(a);var c=Math.atan2(a.y-b.y,a.x-b.x)-Math.PI/2;c&&this._arrow.setAttrs({rotation:c});return this._arrow},__defaultArrowConfig:{strokeWidth:1,stroke:"black",fill:"black",lineCap:"butt",points:[-3,-2,3,-2,0,6],rotate:0},_defaultBreakConfig:{x:100,y:100,radius:5,stroke:"#666",fill:"#ddd",strokeWidth:1,draggable:!0},
__defaultLineConfig:{strokeWidth:2,stroke:"black",lineCap:"butt",points:[0,0,1,1],lineJoin:"round"}};
var scgDrawFunction={simpleLine:function(a,b,c){a.lineWidth=2;a.moveTo(b.x,b.y);a.lineTo(c.x,c.y)},dashLine:function(a,b,c){var e=Math.atan2(b.y-c.y,b.x-c.x)+Math.PI;a.translate(b.x,b.y);a.rotate(e);a.lineWidth=2;c=scgHelper.getHypotenuse(b,c);c=Math.floor(c/scgConfig.Arc.DASH_HOR_OFFSET);for(var d=0;d<c;d++)d%2?a.lineTo(d*scgConfig.Arc.DASH_HOR_OFFSET,0):a.moveTo(d*scgConfig.Arc.DASH_HOR_OFFSET,0);a.rotate(-e);a.translate(-b.x,-b.y)},dashVarLine:function(a,b,c){var e=Math.atan2(b.y-c.y,b.x-c.x)+
Math.PI;a.translate(b.x,b.y);a.rotate(e);a.lineWidth=2;c=scgHelper.getHypotenuse(b,c);for(var d=-3,f=1;d<c;f++)if(f%2)a.moveTo(d+=8,0);else for(var g=0;4>g;g++)a.lineTo(d+=2,0),a.moveTo(d+=2,0);a.rotate(-e);a.translate(-b.x,-b.y)},negLine:function(a,b,c){var e=Math.atan2(b.y-c.y,b.x-c.x)+Math.PI;a.translate(b.x,b.y);a.rotate(e);a.lineWidth=f;var d=scgConfig.Arc.DASH_VERT_OFFSET,f=scgConfig.Arc.DASH_VERT_WIDTH;c=scgHelper.getHypotenuse(b,c);c=Math.floor(c/d);for(var g=1;g<=c;g++)a.moveTo(g*d,f/2),
a.lineTo(g*d,-f/2);a.rotate(-e);a.translate(-b.x,-b.y)},fuzLine:function(a,b,c){var e=Math.atan2(b.y-c.y,b.x-c.x)+Math.PI;a.translate(b.x,b.y);a.rotate(e);a.lineWidth=f;var d=scgConfig.Arc.DASH_VERT_OFFSET,f=scgConfig.Arc.DASH_VERT_WIDTH;c=scgHelper.getHypotenuse(b,c);c=Math.floor(c/d);for(var g=1;g<=c;g++){var h=g%2;a.moveTo(g*d,h*f/2);a.lineTo(g*d,(h-1)*f/2)}a.rotate(-e);a.translate(-b.x,-b.y)},varLine:function(a,b,c){var e=Math.atan2(b.y-c.y,b.x-c.x)+Math.PI;a.translate(b.x,b.y);a.rotate(e);c=
scgHelper.getHypotenuse(b,c);for(var d=-5,f=1;d<c;f++)if(f%2)a.moveTo(d+=10,0);else{var g=Math.min(c-d,14);a.lineTo(d+=g,0)}a.rotate(-e);a.translate(-b.x,-b.y)},simpleAccessoryLine:function(a,b,c){a.stroke();a.beginPath();var e=Math.atan2(b.y-c.y,b.x-c.x)+Math.PI;a.translate(b.x,b.y);a.rotate(e);a.lineWidth=4;c=scgHelper.getHypotenuse(b,c);for(var d=-5,f=1;d<c;f++)if(f%2)a.moveTo(d+=10,0);else{var g=Math.min(c-d,4);a.lineTo(d+=g,0)}a.rotate(-e);a.translate(-b.x,-b.y);a.stroke()},undefinedPairLine:function(a,
b,c){a.lineWidth=6;a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.stroke();a.strokeStyle="#ffffff";a.beginPath();a.lineWidth=4;a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.stroke();a.strokeStyle="#000";a.beginPath();var e=Math.atan2(b.y-c.y,b.x-c.x)+Math.PI;a.translate(b.x,b.y);a.rotate(e);a.strokeWidth=1;a.lineWidth=1;c=scgHelper.getHypotenuse(b,c);for(var d=-5,f=1;d<c;f++)if(f%2)a.moveTo(d+=10,0);else{var g=Math.min(c-d,14);a.lineTo(d+=g,0)}a.rotate(-e);a.translate(-b.x,-b.y)},undefinedConstPairLine:function(a,
b,c){a.lineWidth=6;a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.stroke();a.strokeStyle="#ffffff";a.beginPath();a.lineWidth=4;a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.stroke();a.strokeStyle="#000";a.beginPath()},undefinedVarPairLine:function(a,b,c){a.lineWidth=6;a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.stroke();a.strokeStyle="#ffffff";a.beginPath();a.lineWidth=4;var e=Math.atan2(b.y-c.y,b.x-c.x)+Math.PI;a.translate(b.x,b.y);a.rotate(e);c=scgHelper.getHypotenuse(b,c);for(var d=-5,f=1;d<c;f++)if(f%2)a.moveTo(d+=
10,0);else{var g=Math.min(c-d,14);a.lineTo(d+=g,0)}a.rotate(-e);a.translate(-b.x,-b.y);a.stroke();a.beginPath();a.strokeStyle="#000"}},scgConfig={Arc:{nodeIndent:20,DASH_VERT_OFFSET:24,DASH_VERT_WIDTH:10,DASH_HOR_OFFSET:2},Node:{}},scgHelper={getHypotenuse:function(a,b){var c=Math.abs(a.x-b.x),e=Math.abs(a.y-b.y),d=Math.max(c,e),c=Math.min(c,e)/d;return d*Math.sqrt(1+c*c)}},scgKineticRenderer=function(a){this._initScgKineticRenderer(a)};scgKineticRenderer._renderers=[];
scgKineticRenderer.registerTypeRenderer=function(a,b){scgKineticRenderer._renderers[a]=b;return scgKineticRenderer};scgKineticRenderer.getTypeRenderer=function(a){var b=a&sc_type_element_mask;if(b==sc_type_arc_common||b==sc_type_arc_access||b==sc_type_edge_common)return scgArc;if(b==sc_type_node){if((a&sc_type_constancy_mask)==sc_type_const)return scgNodeConst;if((a&sc_type_constancy_mask)==sc_type_var)return scgNodeVar}throw Error("Undefined type of renderer "+a);};
scgKineticRenderer.prototype={_initScgKineticRenderer:function(a){this._graph=a.graph;this._container=a.container;this._arcs=[];this._nodes=[];this._initProperties(a);a=this._getStage();this._layerArcs=this._layerNodes=new Kinetic.Layer;a.add(this._layerArcs);a.add(this._layerNodes)},_initProperties:function(a){for(var b in a)b in this||(this["_"+b]=a[b])},_getStage:function(){this._stage||(this._stage=new Kinetic.Stage({container:this._container,width:this._width,height:this._height}));return this._stage},
setGraph:function(a){this._graph=a},getGraph:function(){return this._graph},reDraw:function(){for(var a in this._arcs)this._arcs[a].reDraw();for(a in this._nodes)this._nodes[a].reDraw()},render:function(){this._renderNodes();this._renderArcs();this._layerNodes.draw();this._layerArcs.draw()},_renderArcs:function(){var a=this._graph.arcs,b;for(b in a){var c=new (scgKineticRenderer.getTypeRenderer(a[b].type))(this._layerArcs,a[b],this);this._arcs.push(c)}},_renderNodes:function(){var a=this._graph.nodes,
b;for(b in a){var c=new (scgKineticRenderer.getTypeRenderer(a[b].type))(this._layerNodes,a[b],this);this._nodes.push(c)}}};var scgNode=function(a,b,c){this._initNode(a,b,c)};
scgNode.prototype={_initNode:function(a,b,c){this.id=0;this.layer=a;this.node=b;this.idfDrawObj=null;this.color="#000";this._renderer=c;this.draw();this.reDraw()},getRenderer:function(){return this._renderer},setColor:function(a){this.color=a},draw:function(){this.layer.add(this._getIdf());this._draw();return this},reDraw:function(){var a=this.node.getPosition();this._getIdf().setPosition(a.x+10,a.y+10);this._reDraw();return this},_getIdf:function(){if(null!=this.idfDrawObj)return this.idfDrawObj;
this._defaultIdfConfig.text=this.node.idf;return this.idfDrawObj=new Kinetic.Text(this._defaultIdfConfig)},_defaultIdfConfig:{x:110,y:110,text:"",textFill:"gray"}};var scgNodeConst=function(a,b,c){this._initNodeConst(a,b,c)};
scgNodeConst.prototype={_initNodeConst:function(a,b,c){this._bg=this._circle=null;this._initNode(a,b,c)},_draw:function(){this.layer.add(this._getBg());this.layer.add(this._getCircle());return this},_reDraw:function(){var a=this.node.getPosition();this._getBg().setPosition(a);this._getCircle().setPosition(a);return this},_getCircle:function(){if(null==this._circle){this._circle=new Kinetic.Circle(this._defaultCircleConfig);this._circle.setPosition(this.node.getPosition());var a=this;this._circle.on("dragmove",
function(){a.node.setPosition(this.getPosition());a.getRenderer().reDraw()});this._circle.on("mouseover",function(){a.setColor("#f0f");a.getRenderer().reDraw()});this._circle.on("mouseout",function(){a.setColor("#000");a.getRenderer().reDraw()})}this._circle.setStroke(this.color);return this._circle},_getBg:function(){if(null==this._bg){this._bg=new Kinetic.Shape;var a=this;this._bg.setDrawFunc(function(b){a._bgDrawFunc.call(this,b,a)})}return this._bg},_bgDrawFunc:function(a,b){var c=scgNodeConst.drawFunc[b.node.getStructType()];
a.strokeStyle=b.color;a.fillStyle=b.color;c.call(this,a)},_defaultCircleConfig:{x:100,y:100,radius:9,stroke:"#000",strokeWidth:4,draggable:!0}};Kinetic.Global.extend(scgNodeConst,scgNode);
scgNodeConst.drawFunc={general:function(){},relation:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,-7);a.lineTo(7,7);a.moveTo(7,-7);a.lineTo(-7,7);a.stroke()},role:function(a){a.beginPath();a.lineWidth=2;a.moveTo(0,-7);a.lineTo(0,7);a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},group:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,-7);a.lineTo(7,7);a.moveTo(7,-7);a.lineTo(-7,7);a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},tuple:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,0);a.lineTo(7,0);
a.stroke()},"abstract":function(a){a.beginPath();a.lineWidth=1;for(var b=-6;7>b;b+=3)a.moveTo(-7,b),a.lineTo(7,b);a.stroke()},struct:function(a){a.beginPath();a.arc(0,0,2,0,2*Math.PI,!1);a.fill()},material:function(a){a.beginPath();a.rotate(-Math.PI/4);for(var b=-6;7>b;b+=3)a.moveTo(-7,b),a.lineTo(7,b);a.rotate(Math.PI/4);a.stroke()}};var scgNodeVar=function(a,b,c){this._initNodeVar(a,b,c)};
scgNodeVar.prototype={_initNodeVar:function(a,b,c){this._bg=this._rect=null;this._initNode(a,b,c)},_draw:function(){this.layer.add(this._getBg());this.layer.add(this._getRect());return this},_reDraw:function(){var a=this.node.getPosition();this._getBg().setPosition(a);this._getRect().setPosition(a);return this},_getRect:function(){if(null==this._rect){this._rect=new Kinetic.Rect(this._defaultRectConfig);this._rect.setPosition(this.node.getPosition().x,this.node.getPosition());var a=this;this._rect.on("dragmove",
function(){a.node.setPosition(this.getPosition());a.getRenderer().reDraw()});this._rect.on("mouseover",function(){a.node.isActive=!0});this._rect.on("mouseout",function(){a.node.isActive=!1})}this._rect.setStroke(this.color);return this._rect},_getBg:function(){if(null==this._bg){this._bg=new Kinetic.Shape;var a=this;this._bg.setDrawFunc(function(b){a._bgDrawFunc.call(this,b,a)})}return this._bg},_bgDrawFunc:function(a,b){var c=scgNodeVar.drawFunc[b.node.getStructType()];a.strokeStyle=b.color;a.fillStyle=
b.color;c.call(this,a)},_defaultRectConfig:{x:100,y:100,width:14,height:14,offset:{x:7,y:7},stroke:"#000",strokeWidth:4,draggable:!0}};
scgNodeVar.drawFunc={general:function(){},relation:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,-7);a.lineTo(7,7);a.moveTo(7,-7);a.lineTo(-7,7);a.stroke()},role:function(a){a.beginPath();a.lineWidth=2;a.moveTo(0,-7);a.lineTo(0,7);a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},group:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,-7);a.lineTo(7,7);a.moveTo(7,-7);a.lineTo(-7,7);a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},tuple:function(a){a.beginPath();a.lineWidth=2;a.moveTo(-7,0);a.lineTo(7,0);a.stroke()},
"abstract":function(a){a.beginPath();a.lineWidth=1;for(var b=-6;7>b;b+=3)a.moveTo(-7,b),a.lineTo(7,b);a.stroke()},struct:function(a){a.beginPath();a.arc(0,0,2,0,2*Math.PI,!1);a.fill()},material:function(a){a.beginPath();a.rotate(-Math.PI/4);for(var b=-6;7>b;b+=3)a.moveTo(-6,b),a.lineTo(6,b);a.rotate(Math.PI/4);a.stroke()}};Kinetic.Global.extend(scgNodeVar,scgNode);
